<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Snake Pro: Miku x Waguri üå∏</title>
  <style>
    :root {
      --bg-color: #05070a;
      --board-color: #0f172a;
      --snake-head: #00ff88;
      --snake-body: #008f5d;
      --neon-border: #6366f1;
      --neon-pink: #ff007f;
      --glow: 0 0 15px var(--snake-head), 0 0 5px #fff;
    }

    body {
      margin: 0; font-family: 'Segoe UI', sans-serif;
      background-color: var(--bg-color); color: white;
      display: flex; flex-direction: column; align-items: center;
      min-height: 100vh; overflow: hidden;
    }

    #menuOverlay, #settingsOverlay {
      position: absolute; width: 100%; height: 100%;
      background: rgba(5, 7, 10, 0.98);
      display: flex; flex-direction: column;
      justify-content: center; align-items: center;
      z-index: 100; transition: 0.3s;
    }
    #settingsOverlay { display: none; }

    .btn-group { display: flex; flex-direction: column; gap: 12px; width: 280px; align-items: center; }
    
    .menu-btn {
      width: 100%; background: transparent; color: white; border: 2px solid var(--neon-border);
      padding: 12px; border-radius: 12px; cursor: pointer; transition: 0.2s;
    }

    .level-row { display: flex; justify-content: space-between; width: 100%; gap: 8px; }

    .level-btn {
      flex: 1; background: transparent; color: white; border: 2px solid var(--neon-border);
      padding: 10px 0; border-radius: 10px; cursor: pointer; transition: 0.2s;
      font-size: 0.9rem; text-align: center;
    }

    .menu-btn:hover, .level-btn:hover, .active { background: var(--neon-border); box-shadow: 0 0 15px var(--neon-border); }

    .global-settings-btn {
      position: fixed; top: 15px; right: 15px;
      background: rgba(255,255,255,0.1); border: 1px solid var(--neon-border);
      color: white; font-size: 1.5rem; width: 45px; height: 45px;
      border-radius: 50%; cursor: pointer; z-index: 50;
    }

    #notifArea {
      height: 30px; margin-top: 10px; font-weight: bold;
      color: var(--neon-pink); text-shadow: 0 0 10px var(--neon-pink);
      font-style: italic; transition: 0.3s; opacity: 0;
    }

    #gameArea {
      position: relative; background-color: var(--board-color);
      width: 300px; height: 300px;
      border: 4px solid var(--neon-border); border-radius: 15px;
      box-shadow: 0 0 25px var(--neon-border);
    }

    .snake { width: 20px; height: 20px; position: absolute; border-radius: 8px; background: linear-gradient(45deg, var(--snake-body), var(--snake-head)); z-index: 2; box-shadow: var(--glow); }
    .snake-head { border-radius: 10px; background: var(--snake-head) !important; z-index: 3; }
    .snake-head::after, .snake-head::before { content: ''; position: absolute; width: 4px; height: 4px; background: black; border-radius: 50%; top: 4px; }
    .snake-head::before { left: 4px; } .snake-head::after { right: 4px; }
    .food { width: 20px; height: 20px; position: absolute; font-size: 18px; display: flex; justify-content: center; align-items: center; text-shadow: var(--glow); }

    .joystick { display: grid; grid-template-areas: ". up ." "left . right" ". down ."; gap: 10px; margin-top: 20px; }
    .joybtn { background: rgba(99, 102, 241, 0.1); color: white; border: 2px solid var(--neon-border); padding: 15px 25px; border-radius: 15px; cursor: pointer; }

    footer { margin-top: auto; padding-bottom: 10px; font-size: 0.7rem; color: rgba(255,255,255,0.3); font-style: italic; }
  </style>
</head>
<body>

  <button class="global-settings-btn" onclick="openSettings()">‚öôÔ∏è</button>

  <div id="menuOverlay">
    <h1 style="color:var(--neon-border); text-shadow: 0 0 15px; margin-bottom: 5px;">üêç Real Snake Game</h1>
    <div style="color: var(--neon-pink); font-size: 0.9rem; font-weight: bold; text-shadow: 0 0 10px var(--neon-pink); margin-bottom: 25px; letter-spacing: 1px;">miku</div>
    
    <div class="btn-group">
      <button class="menu-btn" style="background:var(--neon-border); font-weight:bold; font-size:1.3rem;" onclick="startGame()">PLAY üå∏</button>
      <div style="text-align:center; margin-top:10px; font-size: 0.8rem; color: var(--neon-border);">KESULITAN:</div>
      <div class="level-row">
        <button class="level-btn active" id="lv1" onclick="setLevel(200, 'lv1')">Easy</button>
        <button class="level-btn" id="lv2" onclick="setLevel(120, 'lv2')">Med</button>
        <button class="level-btn" id="lv3" onclick="setLevel(60, 'lv3')">Hard</button>
      </div>
    </div>
  </div>

  <div id="settingsOverlay">
    <h2 style="color:var(--neon-border);">SETTINGS ‚öôÔ∏è</h2>
    <div class="btn-group">
      <button class="menu-btn" id="sfxBtn" onclick="toggleSFX()">Sound FX: ON ‚úÖ</button>
      <button class="menu-btn" id="bgmBtn" onclick="toggleBGM()">Musik: OFF ‚ùå</button>
      <div style="text-align:center; margin-top:10px; font-size: 0.8rem; color: var(--neon-border);">GRAFIK:</div>
      <div class="level-row">
        <button class="level-btn" onclick="setGraphics('smooth')">Smooth</button>
        <button class="level-btn" onclick="setGraphics('medium')">Med</button>
        <button class="level-btn active" onclick="setGraphics('hd')">HD</button>
      </div>
      <button class="menu-btn" style="margin-top:20px; border-color:white;" onclick="closeSettings()">KEMBALI üå∏</button>
    </div>
  </div>

  <div id="score" style="margin-top: 15px; font-size: 1.2rem; font-weight: bold; color: var(--snake-head);">Skor: 0</div>
  <div id="notifArea">Waguri Siap!</div>
  <div id="gameArea"></div>

  <div class="joystick">
    <button class="joybtn" style="grid-area: up" onclick="changeDir('up')">‚¨ÜÔ∏è</button>
    <button class="joybtn" style="grid-area: left" onclick="changeDir('left')">‚¨ÖÔ∏è</button>
    <button class="joybtn" style="grid-area: right" onclick="changeDir('right')">‚û°Ô∏è</button>
    <button class="joybtn" style="grid-area: down" onclick="changeDir('down')">‚¨áÔ∏è</button>
  </div>

  <footer>Created with ü§ç by Miku x Waguri Ai</footer>

  <audio id="bgmAudio" loop src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"></audio>

  <script>
    const gameArea = document.getElementById("gameArea"),
          menu = document.getElementById("menuOverlay"),
          settings = document.getElementById("settingsOverlay"),
          bgm = document.getElementById("bgmAudio"),
          notif = document.getElementById("notifArea");

    let snake, direction, food, score, gameLoop, gameSpeed = 200, isSFX = true, isBGM = false, hasCongratulated = false;
    const gridSize = 20, areaLimit = 300;
    
    // VARIABEL AUDIO TETAP ADA
    let audioCtx; 

    function initAudio() {
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if (audioCtx.state === 'suspended') audioCtx.resume();
    }

    function showNotif(msg) {
        notif.textContent = msg;
        notif.style.opacity = "1";
        setTimeout(() => { notif.style.opacity = "0"; }, 3000);
    }

    function playEatSound() {
      if (!isSFX) return;
      initAudio(); // Pastikan audioCtx hidup
      const osc = audioCtx.createOscillator(), gain = audioCtx.createGain();
      osc.frequency.setValueAtTime(800, audioCtx.currentTime);
      osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.05);
      gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
      osc.connect(gain); gain.connect(audioCtx.destination);
      osc.start(); osc.stop(audioCtx.currentTime + 0.1);
    }

    function setLevel(s, id) {
      gameSpeed = s;
      document.querySelectorAll('.level-btn').forEach(b => b.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    function setGraphics(type) {
      const root = document.documentElement;
      if(type === 'smooth') root.style.setProperty('--glow', 'none');
      else if(type === 'medium') root.style.setProperty('--glow', '0 0 5px var(--snake-head)');
      else root.style.setProperty('--glow', '0 0 15px var(--snake-head), 0 0 5px #fff');
    }

    function toggleSFX() {
      initAudio();
      isSFX = !isSFX;
      document.getElementById("sfxBtn").textContent = "Sound FX: " + (isSFX ? "ON ‚úÖ" : "OFF ‚ùå");
    }

    function toggleBGM() {
      initAudio();
      isBGM = !isBGM;
      document.getElementById("bgmBtn").textContent = "Musik: " + (isBGM ? "ON ‚úÖ" : "OFF ‚ùå");
      isBGM ? bgm.play() : bgm.pause();
    }

    function openSettings() { settings.style.display = "flex"; if(gameLoop) clearInterval(gameLoop); }
    function closeSettings() { settings.style.display = "none"; if(!menu.style.display || menu.style.display === "none") gameLoop = setInterval(move, gameSpeed); }

    function startGame() { 
      initAudio();
      menu.style.display = "none"; 
      reset(); 
      gameLoop = setInterval(move, gameSpeed); 
    }

    function draw() {
      gameArea.innerHTML = "";
      snake.forEach((seg, i) => {
        const s = document.createElement("div");
        s.className = i === 0 ? "snake snake-head" : "snake";
        if(i === 0) {
          const rot = {up:0, down:180, left:-90, right:90}[direction];
          s.style.transform = `rotate(${rot}deg)`;
        }
        s.style.left = seg.x + "px"; s.style.top = seg.y + "px";
        gameArea.appendChild(s);
      });
      const f = document.createElement("div");
      f.className = "food"; f.innerHTML = "üçé";
      f.style.left = food.x + "px"; f.style.top = food.y + "px";
      gameArea.appendChild(f);
    }

    function move() {
      const head = {...snake[0]};
      if (direction === "up") head.y -= gridSize;
      if (direction === "down") head.y += gridSize;
      if (direction === "left") head.x -= gridSize;
      if (direction === "right") head.x += gridSize;

      if (head.x < 0 || head.x >= areaLimit || head.y < 0 || head.y >= areaLimit || 
          snake.some(s => s.x === head.x && s.y === head.y)) {
        showNotif(" Belajar lagi dekk ");
        clearInterval(gameLoop); 
        bgm.pause(); 
        setTimeout(() => { menu.style.display = "flex"; }, 1500);
        return;
      }
      snake.unshift(head);
      if (head.x === food.x && head.y === food.y) {
        score += 10; 
        playEatSound(); // SUARA DIPANGGIL DI SINI
        if(score >= 50 && !hasCongratulated) {
            showNotif("Wahhh boleh juga skil lu ‚ù§Ô∏è");
            hasCongratulated = true;
        }
        food = { x: Math.floor(Math.random()*14)*20, y: Math.floor(Math.random()*14)*20 };
      } else { snake.pop(); }
      document.getElementById("score").textContent = "Skor: " + score;
      draw();
    }

    function reset() { 
        snake = [{x: 100, y: 100}, {x: 80, y: 100}]; 
        direction = "right"; score = 0; 
        food = {x: 200, y: 200}; 
        hasCongratulated = false;
        notif.style.opacity = "0";
        draw(); 
    }
    
    function changeDir(d) {
      if (d === "up" && direction !== "down") direction = "up";
      if (d === "down" && direction !== "up") direction = "down";
      if (d === "left" && direction !== "right") direction = "left";
      if (d === "right" && direction !== "left") direction = "right";
    }
  </script>
</body>
</html>
